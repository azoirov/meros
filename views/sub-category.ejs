<% var products %>
<%
    const capitalize = text => {
        return text[0].toUpperCase() + text.substring(1)
    }
%>
<%- include('partials/header') %>

<section class="category-intro">
    <div class="container">
        <header class="category-intro__header">
            <h2 class="section__heading"><%= category.ru_name[0].toUpperCase() + category.ru_name.substring(1) %></h2>
            <span class="category-intro__total-count"><%= products.length %> товаров</span>
        </header>
        <main class="category-intro__main">
            <nav class="category-intro__nav">
                <ul class="category-intro__ul">
                    <% sub_category.forEach((sub_cat, index) => { %>
                        <% if(index <= 5)  { %>
                            <li class="category-intro__li">
                                <a class="category-intro__link"
                                   href="/category/<%= category.slug %>/<%= sub_cat.sub_category_slug %>"><%= sub_cat.sub_category_name_ru %></a>
                            </li>
                        <% } %>
                    <% }) %>
                </ul>
                <button class="category-intro__nav-open">
                    <img src="/images/icons/menu.svg" alt="">
                    <span>Категории</span>
                </button>
            </nav>
            <div class="category-intro__ads">
                <div class="category-intro__big-ad">
                    <a href="<%= (banners?.big_banner_url) ? banners?.big_banner_url : '#' %>">
                        <img src="<%= (banners?.big_banner_image_2x) ? '/images/category_banners/' + category.category_id + '/' + banners?.big_banner_image_2x : 'https://via.placeholder.com/1440x350' %>"
                             alt="">
                    </a>
                </div>
                <div class="category-intro__small-ads">
                    <div class="category-intro__small-ad">
                        <a href="<%= (banners?.small_banner_1_url) ? banners?.small_banner_1_url : '#' %>">
                            <img src="<%= (banners?.small_banner_1_image) ? '/images/category_banners/' + category.category_id + '/' + banners?.small_banner_1_image : 'https://via.placeholder.com/460x170' %>"
                                 alt="">
                        </a>
                    </div>
                    <div class="category-intro__small-ad">
                        <a href="<%= (banners?.small_banner_2_url) ? banners?.small_banner_2_url : '#' %>">
                            <img src="<%= (banners?.small_banner_2_image) ? '/images/category_banners/' + category.category_id + '/' + banners?.small_banner_2_image : 'https://via.placeholder.com/460x170' %>"
                                 alt="">
                        </a>
                    </div>
                    <div class="category-intro__small-ad">
                        <a href="<%= (banners?.small_banner_3_url) ? banners?.small_banner_3_url : '#' %>">
                            <img src="<%= (banners?.small_banner_3_image) ? '/images/category_banners/' + category.category_id + '/' + banners?.small_banner_3_image : 'https://via.placeholder.com/460x170' %>"
                                 alt="">
                        </a>
                    </div>
                </div>
            </div>
        </main>
    </div>
</section>

<section class="section recommends-for-you mb-70">
    <div class="container">
        <header class="section__header">
            <h2 class="section__heading">Лучшие предложения!</h2>
        </header>

        <% if(goodOffers.length > 0) { %>
            <div class="recommends-for-you__slider splide">
                <div class="splide__track">
                    <ul class="splide__list">
                        <% goodOffers.forEach(product => { %>
                            <li class="splide__slide">
                                <div class="product-card">
                                    <div>
                                        <div class="product-card__header">
                                            <img src="/images/products/<%= product.thumb[0] %>"
                                                 alt="<%= product.ru_name %>">
                                            <% if (product.sale) { %>
                                                <span class="product-card__discount">-<%= product.sale %>%</span>
                                            <% } %>
                                            <ul class="product-card__action">
                                                <li class="product-card__action__item">
                                                    <button>
                                                        <img src="/images/icons/eye.svg" alt="eye icon">
                                                    </button>
                                                </li>
                                                <li class="product-card__action__item">
                                                    <% if (product.inWishList) { %>
                                                        <button>
                                                            <img src="/images/icons/star.svg" alt="star icon">
                                                        </button>
                                                    <% } else { %>
                                                        <button style="background: #32386B">
                                                            <img src="/images/icons/star.svg" alt="star icon">
                                                        </button>
                                                    <% } %>
                                                </li>
                                                <li class="product-card__action__item">
                                                    <button>
                                                        <img src="/images/icons/trash.svg" alt="trash icon">
                                                    </button>
                                                </li>
                                            </ul>
                                            <button class="product-card__favourite">
                                                <svg width="20" height="19" viewBox="0 0 20 19" fill="none"
                                                     xmlns="http://www.w3.org/2000/svg">
                                                    <path fill-rule="evenodd" clip-rule="evenodd"
                                                          d="M9.04746 0.656581C9.3769 -0.21886 10.6231 -0.218861 10.9525 0.656581L13.0481
                                                          6.22539L19.0258 6.48493C19.9655 6.52574 20.3506 7.70342 19.6145 8.28527L14.932 11.9865L16.5308
                                                           17.7157C16.7821 18.6164 15.7739 19.3443 14.9895 18.8284L10 15.5471L5.01046 18.8284C4.22608
                                                           19.3443 3.21788 18.6164 3.46922 17.7157L5.068 11.9865L0.385511 8.28527C-0.350596 7.70342 0.0344995
                                                           6.52574 0.974211 6.48493L6.95186 6.22539L9.04746 0.656581ZM10 2.45308L8.26279 7.06948C8.11987
                                                           7.44927 7.76233 7.7074 7.35465 7.7251L2.39934 7.94025L6.281 11.0085C6.60034 11.2609 6.73692
                                                           11.6786 6.62788 12.0693L5.30253 16.8187L9.43874 14.0986C9.77902 13.8748 10.221 13.8748 10.5613
                                                           14.0986L14.6975 16.8187L13.3721 12.0693C13.2631 11.6786 13.3997 11.2609 13.719 11.0085L17.6007
                                                            7.94025L12.6453 7.7251C12.2377 7.7074 11.8801 7.44927 11.7372 7.06948L10 2.45308Z"
                                                          fill="#273142"/>
                                                </svg>
                                            </button>
                                        </div>
                                        <div class="product-card__body">
                                            <a class="product-card__category"
                                               href="/category/<%= product['category.ru_name'] %>"><%= capitalize(product['category.ru_name']) %></a>
                                            <h3 class="product-card__title">
                                                <a style="color: #273142" href="/product/<%= product.slug %>">
                                                    <%= capitalize(product.ru_name) %>
                                                </a>
                                            </h3>
                                            <img class="product-card__rating-stars" src="/images/rating-stars/<%= product.stars %>.svg"
                                                 alt="rating stars">
                                        </div>
                                    </div>
                                    <div>
                                        <div class="product-card__footer">
                                            <span class="product-card__new-price"><%= Math.round(product.price * (100 - product.sale) / 100) %> сум</span>
                                            <del class="product-card__old-price"><%= product.price %> сум</del>
                                        </div>
                                        <button class="to-cart <%= product.inCart ? 'd-none' : '' %>"
                                                data-add-cart="<%= product.product_id %>">
                                            В корзину
                                        </button>
                                        <div class="product-card__cart <%= product.inCart ? '' : 'd-none' %>">
                                            <button class="product-card__cart__btn product-card__cart__btn--increment"
                                                    data-increment-product="<%= product.product_id %>">
                                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                                     xmlns="http://www.w3.org/2000/svg">
                                                    <path d="M12 5V19" stroke="#8D909B" stroke-width="2"
                                                          stroke-linecap="round" stroke-linejoin="round"/>
                                                    <path d="M5 12H19" stroke="#8D909B" stroke-width="2"
                                                          stroke-linecap="round" stroke-linejoin="round"/>
                                                </svg>
                                            </button>
                                            <span><%= product.inCart %></span>
                                            <button class="product-card__cart__btn product-card__cart__btn--decrement"
                                                    data-decrement-product="<%= product.product_id %>">
                                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                                     xmlns="http://www.w3.org/2000/svg">
                                                    <path d="M5 12H19" stroke="#8D909B" stroke-width="2"
                                                          stroke-linecap="round" stroke-linejoin="round"/>
                                                </svg>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </li>
                        <% }) %>
                    </ul>
                </div>
            </div>
        <% } %>
    </div>
</section>

<section class="section popular-categories">
    <div class="container">
        <header class="section__header">
            <h2 class="section__heading">Присмотритесь к категориям</h2>
        </header>
        <div class="popular-categories__slider splide">
            <div class="splide__track">
                <ul class="splide__list">
                    <% sub_category.forEach(el => { %>
                        <li class="splide__slide">
                            <div class="popular-categories__card">
                                <div>
                                    <img src="/images/sub_categories/<%= el.sub_category_image %>"
                                         alt="<%= el.sub_category_name_ru %>">
                                </div>
                                <h3><%= capitalize(el.sub_category_name_ru) %></h3>
                                <a href="/"> </a>
                            </div>
                        </li>
                    <% }) %>
                </ul>
            </div>
        </div>
    </div>
</section>

<section class="section products">
    <div class="container">
        <div class="row">
            <aside class="products__aside">
                <div class="ad-column">
                    <a href="/">
                        <img src="<%= (banners?.side_banner_left_image) ? '/images/category_banners/' + category.category_id + '/' + banners?.side_banner_left_image : 'https://via.placeholder.com/290x790' %>"
                             alt="">
                    </a>
                </div>
            </aside>
            <main class="products__main products--four">
                <% products.forEach(product => { %>
                    <div class="product-card">
                        <div>
                            <div class="product-card__header">
                                <img src="/images/products/<%= product.thumb[0] %>"
                                     alt="<%= product.ru_name %>">
                                <% if (product.sale) { %>
                                    <span class="product-card__discount">-<%= product.sale %>%</span>
                                <% } %>
                                <ul class="product-card__action">
                                    <li class="product-card__action__item">
                                        <button>
                                            <img src="/images/icons/eye.svg" alt="eye icon">
                                        </button>
                                    </li>
                                    <li class="product-card__action__item">
                                        <% if (!product.inWishList) { %>
                                            <button>
                                                <img src="/images/icons/star.svg" alt="star icon">
                                            </button>
                                        <% } else { %>
                                            <button style="background: #32386B">
                                                <img src="/images/icons/star.svg" alt="star icon">
                                            </button>
                                        <% } %>
                                    </li>
                                    <li class="product-card__action__item">
                                        <button>
                                            <img src="/images/icons/trash.svg" alt="trash icon">
                                        </button>
                                    </li>
                                </ul>
                                <button class="product-card__favourite">
                                    <svg width="20" height="19" viewBox="0 0 20 19" fill="none"
                                         xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd" clip-rule="evenodd"
                                              d="M9.04746 0.656581C9.3769 -0.21886 10.6231 -0.218861 10.9525 0.656581L13.0481
                                                          6.22539L19.0258 6.48493C19.9655 6.52574 20.3506 7.70342 19.6145 8.28527L14.932 11.9865L16.5308
                                                           17.7157C16.7821 18.6164 15.7739 19.3443 14.9895 18.8284L10 15.5471L5.01046 18.8284C4.22608
                                                           19.3443 3.21788 18.6164 3.46922 17.7157L5.068 11.9865L0.385511 8.28527C-0.350596 7.70342 0.0344995
                                                           6.52574 0.974211 6.48493L6.95186 6.22539L9.04746 0.656581ZM10 2.45308L8.26279 7.06948C8.11987
                                                           7.44927 7.76233 7.7074 7.35465 7.7251L2.39934 7.94025L6.281 11.0085C6.60034 11.2609 6.73692
                                                           11.6786 6.62788 12.0693L5.30253 16.8187L9.43874 14.0986C9.77902 13.8748 10.221 13.8748 10.5613
                                                           14.0986L14.6975 16.8187L13.3721 12.0693C13.2631 11.6786 13.3997 11.2609 13.719 11.0085L17.6007
                                                            7.94025L12.6453 7.7251C12.2377 7.7074 11.8801 7.44927 11.7372 7.06948L10 2.45308Z"
                                              fill="#273142"/>
                                    </svg>
                                </button>
                            </div>
                            <div class="product-card__body">
                                <a class="product-card__category"
                                   href="/category/<%= product['category.ru_name'] %>"><%= capitalize(product['category.ru_name']) %></a>
                                <h3 class="product-card__title">
                                    <a style="color: #273142" href="/product/<%= product.slug %>">
                                        <%= capitalize(product.ru_name) %>
                                    </a>
                                </h3>
                                <img class="product-card__rating-stars" src="/images/rating-stars/<%= product.stars %>.svg"
                                     alt="rating stars">
                            </div>
                        </div>
                        <div>
                            <div class="product-card__footer">
                                <span class="product-card__new-price"><%= Math.round(product.price * (100 - product.sale) / 100) %> сум</span>
                                <del class="product-card__old-price"><%= product.price %> сум</del>
                            </div>
                            <button class="to-cart <%= product.inCart ? 'd-none' : '' %>"
                                    data-add-cart="<%= product.product_id %>">
                                В корзину
                            </button>
                            <div class="product-card__cart <%= product.inCart ? '' : 'd-none' %>">
                                <button class="product-card__cart__btn product-card__cart__btn--increment"
                                        data-increment-product="<%= product.product_id %>">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                         xmlns="http://www.w3.org/2000/svg">
                                        <path d="M12 5V19" stroke="#8D909B" stroke-width="2"
                                              stroke-linecap="round" stroke-linejoin="round"/>
                                        <path d="M5 12H19" stroke="#8D909B" stroke-width="2"
                                              stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                </button>
                                <span><%= product.inCart %></span>
                                <button class="product-card__cart__btn product-card__cart__btn--decrement"
                                        data-decrement-product="<%= product.product_id %>">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                         xmlns="http://www.w3.org/2000/svg">
                                        <path d="M5 12H19" stroke="#8D909B" stroke-width="2"
                                              stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                <% }) %>
            </main>
        </div>
    </div>
</section>

<section class="additional">
    <div class="container">
        <div class="additional__card">
            <h3>Доставка по всему<br>Узбекистану</h3>
            <a href="/">Условия доставки</a>
            <img src="/images/additional/1.png" alt="">
        </div>
        <div class="additional__card">
            <h3>Установите мобильное<br>приложение</h3>
            <a href="/">Установить</a>
            <img src="/images/additional/2.png" alt="">
        </div>
        <div class="additional__card">
            <h3>Оплата наличными<br>или картой</h3>
            <a href="/">Условия оплаты</a>
            <img src="/images/additional/3.png" alt="">
        </div>
    </div>
</section>

<%- include('cabinet/toast') %>

<%- include('partials/brands') %>

<%- include('partials/catalog-modal') %>
<%- include('partials/categories-modal') %>

<%- include('partials/footer') %>